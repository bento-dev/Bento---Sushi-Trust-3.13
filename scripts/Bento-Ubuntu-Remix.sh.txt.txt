#!/bin/bash

#####################################################################################################
# Install script to add to Ubuntu Mini Remix - http://www.ubuntu-mini-remix.org -                   #
# in order to get a Ubuntu Openbox Remix                                                            #
# More informations from a script where I started to pick ideas:                                    #
# http://bazaar.launchpad.net/~lubuntu-desktop/+junk/lubuntu-tools/view/head:/iso/lubuntu-build.sh  #
# Reviewed and improved by captnfab                                                               #
#####################################################################################################

set -eu	                             # Be strict

export LC_ALL=C

## Add repositories

# Sources.list
wget -c http://meets.free.fr/Downloads/BentoVillageProject/Bento-x86_64/sources.list #to be checked

# Meets # Tiheum # danielrichter2007 # Medibuntu rip - but we want to be able to install libdvdcss - and a few others:
wget -c http://meets.free.fr/Downloads/BentoVillageProject/Configurations/System/bento-sources.list.d.tar.xz
apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 83FBA1751378B444 6E358208E54EEAA4  C383CF524EE6B458 446C82DC2DD154A1

## Updates and installs
# Update in-chroot package database
apt-get -q update

# Install French language packs
apt-get -q -y install wfrench firefox-locale-fr language-pack-fr language-pack-fr-base language-pack-gnome-fr language-pack-gnome-fr-base manpages-fr

# Install headers
apt-get -q -y install linux-headers-generic

# Update the system
# apt-get -q -y dist-upgrade // as a test will not update for this time

# Install core packages //ones not yet installed into Ubuntu Mini Remix
apt-get -q -y --purge install laptop-detect

# Install Xorg / xserver for the graphical environment
apt-get -q -y install xorg gcc-4.6-locales libglide3 mesa-utils xfonts-100dpi xfonts-75dpi xfonts-scalable gcc-4.6 x11-utils

# Install driver and device to setup the touchpad on laptops - and laptop related
apt-get -q -y install xserver-xorg-input-synaptics xserver-xorg-input-mtrack gpointing-device-settings laptop-mode-tools

# Install graphical package manager
apt-get -q -y install synaptic aptdaemon update-notifier ## option for the time being : update-notifier

# Install a few more packages for the system
apt-get -q -y install xdg-user-dirs xdg-user-dirs-gtk upower udisks gnome-system-tools gnome-time-admin policykit-desktop-privileges libpam-ck-connector gnome-keyring scim

# Install a session manager
apt-get -q -y install lightdm lightdm-gtk-greeter ## changing mythbuntu-lightdm-theme background for our use for the time being

# Install plymouth along with a theme
apt-get -q -y install plymouth plymouth-label plymouth-theme-text

# Install packages for the Openbox environment setup
apt-get -q -y install openbox sakura obconf obmenu hsetroot xcompmgr xsnow feh tint2 lxpanel pcmanfm lxappearance-obconf lxshortcut lxsession-edit lxrandr libjpeg-progs

# Install openbox-menu with --force-yes because it is not authentified 
apt-get -q --force-yes --allow-unauthenticated install openbox-menu

# Install packages for the look and feel in the desktop
apt-get -q -y install gtk2-engines-pixbuf gtk2-engines-murrine murrine-themes hicolor-icon-theme gnome-icon-theme gnome-icon-theme-full faenza-icon-theme dmz-cursor-theme 
# gtk2-engines is already in the Ubuntu Mini Remix

## faenza-cupertino icon-theme recolored from tiheum's faenza-icon-theme - for now I have it in the etcskel tarball
#wget -q -c -P /tmp http://gnome-look.org/CONTENT/content-files/129008-Faenza-Cupertino.tar.gz
#mkdir -p /etc/skel/.icons
#tar xvzf /tmp/129008-Faenza-Cupertino.tar.gz -C /etc/skel/.icons
#rm -f /tmp/129008-Faenza-Cupertino.tar.gz

# Install system and hardware related packages 
apt-get -q -y install acpid apmd sdparm ethtool wireless-tools wpasupplicant linux-firmware-nonfree hardinfo ## to be continued

# Packages for network
apt-get -q -y install libatm1 network-manager network-manager-gnome netplug tcpd tcpdump ppp pppconfig pppoe sshfs ssh ssh-import-id  openssl
 
# Install drivers to test the distro in Virtualbox with possibly a good resolution
apt-get -q -y install virtualbox-guest-utils virtualbox-guest-x11

# Install alsa packages, gstreamer and such
apt-get -q -y install alsa-base alsa-oss alsa-tools alsa-utils gnome-alsamixer volumeicon-alsa gstreamer0.10-alsa gstreamer-tools gstreamer0.10-ffmpeg gstreamer0.10-plugins-base gstreamer0.10-plugins-bad gstreamer0.10-plugins-good gstreamer0.10-plugins-ugly gstreamer0.10-pulseaudio gstreamer0.10-tools gstreamer0.10-x libgstreamer-plugins-bad0.10-0 libgstreamer-plugins-base0.10-0 libgstreamer0.10-0 gir1.2-gstreamer-0.10

# A few small text mode utilities
apt-get -q -y install scrot irssi lftp testdisk foremost pastebinit htop mc wodim

# Some graphical applications
apt-get -q -y install firefox xchat file-roller mousepad gpicview galculator evince


# Some sets of fonts
apt-get -q -y install fonts-droid fonts-liberation ttf-dejavu

# Packages for install time
apt-get -q -y install gparted ubiquity ubiquity-casper ubiquity-frontend-gtk ubiquity-ubuntu-artwork 

# Additional and for the time being, with permission of Julien Lavergne - thanks -
# apt-get -q -y install ubiquity-slideshow-lubuntu // tried but that didn't change the black background in Ubiquity

# List borrowed from Lubuntu 
apt-get -q -y install software-properties-gtk language-selector-gnome cifs-utils

# List borrowed from Lubuntu core - http://packages.ubuntu.com/precise/lubuntu-core
apt-get -q -y install anacron bc ca-certificates ghostscript-x inputattach nvidia-common ttf-freefont zip acpi-support  avahi-daemon kerneloops-daemon libnss-mdns pcmciautils 
## paquets à installer peut-être... à voir ??
## blueman bluez bluez-alsa bluez-cups ttf-ubuntu-font-family

# some packages I want to have (need to be spread in categories as time comes)
apt-get -q -y install gksu gfxboot grub-customizer libgtk2.0-bin librsvg2-common gvfs gnupg-agent gnupg2 sound-theme-freedesktop p7zip-full unzip reiserfsprogs jfsutils ntfsprogs ntp rfkill usb-modeswitch xterm deborphan dialog desktop-file-utils gvfs-backends gvfs-fuse pm-utils apport-gtk ibus

# Install configuration files for Bento Ubuntu Openbox Remix, ie the ones for openbox-menu, tint2 and more
wget -q -c -P / http://meets.free.fr/Downloads/BentoVillageProject/Configurations/UserConfig/etcskel.tar.xz
tar xvJf /etcskel.tar.xz -C /
rm -f /etcskel.tar.xz

# Install obsession from mimas development webspace - while it is not yet packaged for Ubuntu
# I will probably copy a binary ready to use to /usr/local
# https://bitbucket.org/fabriceT/obsession

# 64bits : wget -q -c -P / http://meets.free.fr/Downloads/BentoVillageProject/Bento-x86_64/obsession-64bits-precise.tar.xz
# 32bits : wget -q -c -P / http://meets.free.fr/Downloads/BentoVillageProject/Configurations/OldConfig/OBUbuntu-obsession.tar.xz

## Then:
#tar xvJf /obsession-64bits-precise.tar.xz -C /
#rm -f /obsession-64bits-precise.tar.xz

## or:

#tar xvJf /OBUbuntu-obsession.tar.xz -C /
#rm -f /tmp/OBUbuntu-obsession.tar.xz

# Install GTK-3 theme
wget -c / http://meets.free.fr/Downloads/BentoVillageProject/Graphics/bento-GTK3-Clearlooks-Phenix.tar.xz
tar xvfJ /bento-GTK3-Clearlooks-Phenix.tar.xz
rm -f /bento-GTK3-Clearlooks-Phenix.tar.xz

# Install Faenza-Cupertino icons
wget -c / http://meets.free.fr/Downloads/BentoVillageProject/Graphics/bento-Faenza-Cupertino-icons.tar.xz
tar xvfJ /bento-Faenza-Cupertino-icons.tar.xz
rm -f /bento-Faenza-Cupertino-icons.tar.xz

# Install Bento backgrounds:
wget -c / http://meets.free.fr/Downloads/BentoVillageProject/Graphics/bento-backgrounds.tar.xz
tar xvJf /bento-backgrounds.tar.xz
rm -f /bento-backgrounds.tar.xz

# Install modified lightdm-theme for Bento and background images
wget -c / http://meets.free.fr/Downloads/BentoVillageProject/Graphics/bento-lightdm.tar.xz
tar xvfJ /bento-lightdm.tar.xz -C /
rm -f /bento-lightdm.tar.xz

# Install Bento Plymouth theme
wget -c / http://meets.free.fr/Downloads/BentoVillageProject/Graphics/bento-plymouth.tar.xz
tar xvfJ /bento-plymouth.tar.xz
rm -f /bento-plymouth.tar.xz

# Install Bento Lxpanel theme
wget -c / http://meets.free.fr/Downloads/BentoVillageProject/Graphics/bento-Lxpanel.tar.xz
tar xvfJ /bento-Lxpanel.tar.xz
rm -f /bento-Lxpanel.tar.xz

# Install the /root files
wget -c / http://meets.free.fr/Downloads/BentoVillageProject/Configurations/System/bento-root-directory.tar.xz
tar xvfJ /bento-root-directory.tar.xz
rm -f /bento-root-directory.tar.xz

# ZRAM
apt-get -q -y install zram-config ## / Ne pas oublier de configurer le fichier qui_va_bien pour avoir zram dans le live - un fichier est sous squashfs-root/usr/share/initramfs-tools/conf.d avec un fichier "compcache" et l'autre dans quashfs-root/etc/initramfs-tools/initramfs.conf 
wget -q -c -P / http://meets.free.fr/Downloads/BentoVillageProject/Configurations/OldConfig/OBUbuntu-Zram-live.tar.xz
tar xvJf /OBUbuntu-Zram-live.tar.xz -C /
rm -f /OBUbuntu-Zram-live.tar.xz

# Remove old kernels
apt-get remove --purge -q -y $(dpkg -l 'linux-image-*' | grep ^ii | head -1 | awk '{print $2}')

## Reconfigure a few items
# If /var/lock is missing Ubiquity is not started - we should check
# cd /
# ls -l var/lock
# mkdir var/lock

# If virtualbox-dkms is installed the guest graphical driver is not used
# apt-get -q -y --purge remove virtualbox-dkms

# If this file is in the system there is an ugly "Other" empty submenu in Applications
rm -f usr/share/applications/synaptic-kde.desktop

# attendre deux secondes et s'auto-détruire
sleep 2
rm -f /Bento-Ubuntu-Remix.sh.txt

## What can be still missing? 
apt-get -q -y install grub-customizer fake-pae xnoise deadbeef 
